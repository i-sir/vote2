<include file="public@header"/>
</head>
<body>
<div class="wrap js-check-wrap">
    <ul class="nav nav-tabs">
        <li class="active"><a href="{:url('SlideItem/index',['slide_id'=>$slide_id])}">轮播图管理</a></li>
        <li><a href="{:url('SlideItem/add',['slide_id'=>$slide_id])}">添加轮播图</a></li>
    </ul>
    <form method="post" class="js-ajax-form margin-top-20 layui-form" action="{:url('SlideItem/listOrder')}">
        <div class="table-actions">
            <button class="btn btn-primary btn-sm js-ajax-submit" type="submit">{:lang('SORT')}</button>
        </div>
        <php>
			$status = ['隐藏', '开启'];
			$target = ['_blank'=>'新窗口', '_self'=>'当前窗口', '_parent'=>'父窗口', '_top'=>'主窗口'];
        </php>
        <table class="table table-hover table-bordered">
            <thead>
            <tr>
                <th width="50">{:lang('SORT')}</th>
                <th>图片</th>
                <th>标题</th>
                <th>描述</th>
                <th>链接</th>
                <th>发布</th>
                <th width="200">{:lang('ACTIONS')}</th>
            </tr>
            </thead>
            <tbody>
            <foreach name="result" item="vo">
                <tr>
                    <td>
                        <input name="list_orders[{$vo.id}]" class="input-order" type="text" value="{$vo.list_order}">
                    </td>
                    <td>
                        <if condition="!empty($vo['image'])">
                            <a href="javascript:imagePreviewDialog('{:cmf_get_image_preview_url($vo.image)}');">
                                <img src="{:cmf_get_image_preview_url($vo.image)}" style="height:40px;">
                            </a>
                        </if>
                    </td>
                    <td>{$vo.title}</td>
                    <td>{$description = mb_substr($vo['description'], 0, 48,'utf-8')}</td>
                    <td>{$vo.url}</td>
                    <td>
                        <div class="layui-form" style="margin-bottom: 10px">
                            <input type="checkbox" lay-skin="switch" lay-text="是|否" lay-filter="status" name="status" value="{$vo.id}" <if condition="$vo.status == 1">checked</if>>
                        </div>
                    </td>
                    <td>
                        <a class="btn btn-xs btn-primary" href="{:url('SlideItem/edit',array('id'=>$vo['id']))}">{:lang('EDIT')}</a>
                        <a href="{:url('SlideItem/delete',array('id'=>$vo['id']))}"
                           class="btn btn-xs btn-danger js-ajax-delete">{:lang('DELETE')}</a>
                    </td>
                </tr>
            </foreach>
            </tbody>
        </table>
    </form>

</div>
<script src="__STATIC__/js/admin.js"></script>
<script>
    layui.use(['layer', 'form','slider','laydate'], function(){
        var layer = layui.layer,form = layui.form,laydate = layui.laydate;
        //发布不发布
        form.on('switch(status)', function(data){
            var status = 2;
            var id = data.value;
            if(this.checked){
                status = 1;
            }
            $.ajax({
                url:'/admin/slideItem/setStatus',
                type:"POST",
                data: {id:id,type:1,status:status},
                success: function(res) {
                    //console.log(res);
                    if(res.code==1){
                        layer.msg(res.msg, {icon:1});
                    }else{
                        layer.msg(res.msg, {icon: 7});
                    }
                }
            });
        });
    });

</script>
</body>
</html>