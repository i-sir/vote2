<!--用户id-->
<div class="form-group" style="display:none;">
    <label class="col-sm-2 control-label">用户信息:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="user_id" class="form-control post-params item-left" value="{$user_id|default=''}">
    </div>
</div>


<!--order_num-->
<div class="form-group" style="display:none;">
    <label class="col-sm-2 control-label">order_num:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="order_num" class="form-control post-params item-left" value="{$order_num|default=''}">
    </div>
</div>


<!--序号-->
<div class="form-group" style="display:none;">
    <label class="col-sm-2 control-label">序号:</label>
    <div class="layui-input-block col-sm-6">
        <input type="number" class="form-control post-params item-left" name="number" value="{$number|default=''}">
    </div>
</div>


<!--姓名-->
<div class="form-group">
    <label class="col-sm-2 control-label">姓名:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="username" class="form-control post-params item-left" value="{$username|default=''}">
    </div>
</div>


<!--性别-->
<div class="form-group">
    <label class="col-sm-2 control-label">性别:</label>
    <div class="layui-input-block col-sm-6" style="">
        <select class="post-params" lay-search lay-filter="gender" name="gender">
            <option value="男"
            <if condition="$gender eq '男' ">selected</if>
            >男</option>

            <option value="女"
            <if condition="$gender eq '女' ">selected</if>
            >女</option>
        </select>
    </div>
</div>


<!--出生年月日-->
<div class="form-group">
    <label class="col-sm-2 control-label">出生年月日:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="birth" class="form-control post-params item-left js-date" value="{$birth|default=''}">
    </div>
</div>


<!--民族-->
<div class="form-group">
    <label class="col-sm-2 control-label">民族:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="nation" class="form-control post-params item-left" value="{$nation|default=''}">
    </div>
</div>


<!--宗教信仰-->
<div class="form-group">
    <label class="col-sm-2 control-label">宗教信仰:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="religion" class="form-control post-params item-left" value="{$religion|default=''}">
    </div>
</div>


<!--身份证-->
<div class="form-group">
    <label class="col-sm-2 control-label">身份证:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" class="form-control post-params item-left" name="id_number"
               value="{$id_number|default=''}">
    </div>
</div>


<!--联系方式-->
<div class="form-group">
    <label class="col-sm-2 control-label">联系方式:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="phone" class="form-control post-params item-left" value="{$phone|default=''}">
    </div>
</div>


<!--所在地-->
<!--<div class="form-group">-->
<!--    <label class="col-sm-2 control-label">所在地:</label>-->
<!--    <div class="layui-input-block col-sm-6">-->
<!--        <input type="text" name="location" class="form-control post-params item-left" value="{$location|default=''}">-->
<!--    </div>-->
<!--</div>-->

<div class="form-group">
    <div class="layui-form-item">
        <label class="col-sm-2 control-label">地区:</label>
        <div class="col-md-6 col-sm-10" style="">
            <div class="layui-inline">
                <select class="province_code" lay-filter="province_code" lay-search lay-verify="required"
                        name="province_code">
                    <option value="{$province_code}">{$province}</option>
                </select>
            </div>
            <div class="layui-inline">
                <select class="city_code" lay-filter="city_code" lay-search lay-verify="required" name="city_code">
                    <option value="{$city_code}">{$city}</option>
                </select>
            </div>
            <div class="layui-inline">
                <select class="county_code" lay-search lay-filter="county_code" lay-verify="required"
                        name="county_code">
                    <option value="{$county_code}">{$county}</option>
                </select>
            </div>
        </div>
    </div>

</div>

<!--报名赛道-->
<div class="form-group">
    <label class="col-sm-2 control-label">报名赛道:</label>
    <div class="layui-input-block col-sm-6" style="">
        <if condition="!empty($track)">
            <select class="form-control post-params" lay-search lay-filter="track" name="track">
                <foreach item="vo" key="key" name="register_track">
                    <option value="{$vo}"
                    <if condition="$track eq $vo ">selected</if>
                    >{$vo}</option>
                </foreach>
            </select>
            <else/>
            <select class="form-control post-params" lay-search lay-filter="track" name="track">
                <foreach item="vo" key="key" name="register_track">
                    <option value="{$vo}">{$vo}</option>
                </foreach>
            </select>
        </if>
    </div>
</div>


<!--兴趣爱好-->
<div class="form-group">
    <label class="col-sm-2 control-label">兴趣爱好:</label>
    <div class="layui-input-block col-sm-6" style="">
        <if condition="!empty($interests)">
            <select class="form-control post-params" lay-search lay-filter="interests" name="interests">
                <foreach item="vo" key="key" name="hobbies_list">
                    <option value="{$vo}"
                    <if condition="$interests eq $vo ">selected</if>
                    >{$vo}</option>
                </foreach>
            </select>
            <else/>
            <select class="form-control post-params" lay-search lay-filter="interests" name="interests">
                <foreach item="vo" key="key" name="hobbies_list">
                    <option value="{$vo}">{$vo}</option>
                </foreach>
            </select>
        </if>
    </div>
</div>

<!--情感状态-->
<div class="form-group">
    <label class="col-sm-2 control-label">情感状态:</label>
    <div class="layui-input-block col-sm-6">
        <div class="layui-inline">

            <if condition="!empty($emotion)">
                <select class="form-control post-params" lay-search id="emotion" lay-filter="emotion" name="emotion">
                    <foreach item="vo" key="key" name="emotional_state">
                        <option value="{$key}"
                        <if condition="$emotion eq $key ">selected</if>
                        >{$vo}</option>
                    </foreach>


                    <option value="其他"
                    <if condition="strstr($emotion, '其他')">selected</if>
                    >其他</option>
                </select>
                <else/>
                <select class="form-control post-params" lay-search id="emotion" lay-filter="emotion" name="emotion">
                    <foreach item="vo" key="key" name="emotional_state">
                        <option value="{$key}">{$vo}</option>
                    </foreach>


                    <option value="其他"
                    <if condition="strstr($emotion, '其他')">selected</if>
                    >其他</option>
                </select>
            </if>


        </div>


        <div class="layui-inline">
            <div class="emotion_show_type emotion_show_type其他">
                <input type="text" name="emotion_other" class="form-control post-params item-left"
                       value="{$emotion_other}" placeholder="其他">
            </div>
        </div>
    </div>
</div>


<!--<div class="form-group emotion_show_type emotion_show_type其他">-->
<!--    <label class="col-sm-2 control-label">情感状态(其他):</label>-->
<!--    <div class="layui-input-block col-sm-6">-->
<!--        <input type="text" name="emotion_other" class="form-control post-params item-left" value="{$emotion_other}">-->
<!--    </div>-->
<!--</div>-->


<script>
    layui.use(['layer', 'form'], function () {
        let layer = layui.layer, form = layui.form;
        const emotionShowType = $("#emotion").val();
        setShow(emotionShowType)
        form.on('select(emotion)', function (data) {
            setShow(data.value)
        })

        function setShow(showType) {
            $('.emotion_show_type').css('display', 'none');
            $('.emotion_show_type' + showType).css('display', 'block');
            //可以初始化值为空
        }
    });
</script>


<!--演舞经验-->
<div class="form-group">
    <label class="col-sm-2 control-label">演舞经验:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="dance" class="form-control post-params item-left" value="{$dance|default=''}">
    </div>
</div>


<!--擅长的歌曲/特色-->
<div class="form-group">
    <label class="col-sm-2 control-label">擅长的歌曲/特色:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="song" class="form-control post-params item-left" value="{$song|default=''}">
    </div>
</div>

<!--给自己贴个标签-->
<!--多选-->
<div class="form-group">
    <label class="col-sm-2 control-label">给自己贴个标签:</label>
    <div class="layui-input-block col-sm-6">
        <foreach name="registration_label" item="tag_value" key="key">
            <input class="form-control post-params" lay-skin="tag" name="tag[{$tag_value}]"
                   title="{$tag_value}"
                   type="checkbox"
            <if condition="strstr($tag, $tag_value)">checked</if>
            >
        </foreach>


        <input class="form-control post-params" lay-skin="tag" name="tag[其他]"
               title="其他"
               type="checkbox"
               lay-filter="other-tag-toggle"
        <if condition="strstr($tag, '其他')">checked</if>
        >
    </div>
</div>



<div class="form-group tag_show_type tag_show_type其他" style="display: none;">
    <label class="col-sm-2 control-label">标签(其他):</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="tag_other" class="form-control post-params item-left" value="{$tag_other|default=''}">
    </div>
</div>


<script>
    layui.use(['layer', 'form', 'jquery'], function () {
        let layer = layui.layer,
            form = layui.form,
            $ = layui.jquery;

        // 页面加载时检查"其他"是否已选中
        $(function () {
            if ($('input[name="tag[其他]"]').is(':checked')) {
                $(".tag_show_type其他").show();
            }
        });

        // 监听"其他"标签复选框的变化
        form.on('checkbox(other-tag-toggle)', function (data) {
            if (data.elem.checked) {
                $(".tag_show_type其他").show();  // 选中时显示输入框
            } else {
                $(".tag_show_type其他").hide();  // 取消选中时隐藏
                $("input[name='tag_other']").val(''); // 同时清空输入值
            }
            form.render();  // 重新渲染表单
        });
    });
</script>


<!--平台账号-->
<div class="form-group">
    <label class="col-sm-2 control-label">平台账号:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" name="account" class="form-control post-params item-left" value="{$account|default=''}">
    </div>
</div>


<!--照片-->
<div class="form-group">
    <label class="col-sm-2 control-label">照片:</label>
    <div class="layui-input-block col-sm-6">
        <input type="hidden" class="form-control post-params item-left" name="image" id="photo-00000019"
               value="{$image}">
        <if condition='!empty($image)'>
            <a href="javascript:imagePreviewDialog('{:cmf_get_asset_url($image)}');">
                <img src='{:cmf_get_image_preview_url($image)}' id='photo-00000019-preview' style='width: 85px;'>
            </a>
            <else/>
            <img src='/static/images/default.png' id='photo-00000019-preview' style='width: 85px;'>
        </if>
        <a href="javascript:uploadOneImage('图片上传','#photo-00000019','image');">上传</a>
        <a onclick="$('#photo-00000019-preview').attr('src','__TMPL__/public/assets/images/default-thumbnail.png');$('#photo-00000019').val('');return false;">取消图片</a>
    </div>
</div>


<!--视频-->
<div class="form-group">
    <label class="col-sm-2 control-label">视频:</label>
    <div class="layui-input-block col-sm-6">
        <input type="text" class="form-control post-params item-left" name="video" id="video-00000020"
               readonly="readonly" value="{$video}">
        <if condition='!empty($video)'>
            <a id="video-00000020-preview" href="{:cmf_get_file_download_url($video)}"
               target="_blank">下载</a>
        </if>
        <a href="javascript:uploadOne('视频上传','#video-00000020','video');">上传</a>
        <a onclick="$('#video-00000020').val('');return false;">取消</a>
    </div>
</div>


<!--投票数量-->
<div class="form-group">
    <label class="col-sm-2 control-label">投票数量:</label>
    <div class="layui-input-block col-sm-6">
        <input type="number" class="form-control post-params item-left" name="vote_number"
               value="{$vote_number|default=''}">
    </div>
</div>


<!--地区三级联动 layui-->
<script>
    /**
     *


     -----数据库字段名----
     province:省
     city:市
     county:区
     province_code:省code
     city_code:市code
     county_code:区code
     可有可无字段:
     province_id:省id
     city_id:市id
     county_id:区id
     lnglat:经纬度
     lng:经度
     lat:纬度




     ------后台控制器增加方法-----

     public function getArea()
     {
        if (cache('admin_region_list')) {
            $area = cache('admin_region_list');
        } else {
            $area = Db::name('region')->where('parent_id', '=', 10000000)->field('id,name,code')->select()->each(function ($item, $key) {
                $item['cityList'] = Db::name("region")->where(['parent_id' => $item['id']])->field('id,name,code')->select()->each(function ($item1, $key) {
                    $item1['areaList'] = Db::name("region")->where(['parent_id' => $item1['id']])->field('id,name,code')->select()->each(function ($item2, $key) {
                        return $item2;
                    });
                    return $item1;
                });
                return $item;
            });
            cache("admin_region_list", $area);
        }
        $this->success('list', '', $area);
    }


     -----编辑处理数据----

     //经纬度单独存
     $lnglat        = explode(',', $params['lnglat']);
     $params['lng'] = $lnglat[0];//经度
     $params['lat'] = $lnglat[1];//纬度
     //省市区基本信息
     $province_info = Db::name('region')->where('code', '=', $params['province_code'])->find();
     $city_info     = Db::name('region')->where('code', '=', $params['city_code'])->find();
     $county_info   = Db::name('region')->where('code', '=', $params['county_code'])->find();
     //name
     $params['province'] = $province_info['name'];
     $params['city']     = $city_info['name'];
     $params['county']   = $county_info['name'];
     //id
     $params['province_id'] = $province_info['id'];
     $params['city_id']     = $city_info['id'];
     $params['county_id']   = $county_info['id'];

     **/


    layui.use(['form', 'element'], function () {
        var form = layui.form,
            element = layui.element;
        var provinceList;
        $.ajax({
            url: "{:url('getArea')}",
            type: "GET",
            async: false,
            success: function (res) {
                //console.log(res);
                if (res.code == 1) {
                    provinceList = res.data;
                } else {
                    layer.msg(res.msg, {icon: 7});
                }
            }
        });

        var province = $(".province_code");

        //初始将省份数据赋予
        for (var i = 0; i < provinceList.length; i++) {
            addEle(province, provinceList[i].name, provinceList[i].code);
        }

        //向select中 追加内容
        function addEle(ele, value, code) {
            var optionStr = "";
            optionStr = "<option value=" + code + " >" + value + "</option>";
            ele.append(optionStr);
        }

        //重新渲染select
        form.render('select');

        //移除select中所有项
        function removeEle(ele) {
            ele.find("option").remove();
            var optionStar = "<option value=''>" + "请选择" + "</option>";
            ele.append(optionStar);
        }

        var provinceText,
            cityText,
            cityItem;
        //选定省份后 将该省份的数据读取追加上
        form.on('select(province_code)', function (data) {
            console.log(data);
            var city = $(data.elem).parents(".layui-form-item").find(".city_code"),
                district = $(data.elem).parents(".layui-form-item").find(".county_code");
            provinceText = data.value;

            $.each(provinceList, function (i, item) {
                if (provinceText == item.code) {
                    cityItem = i;
                    return cityItem;
                }
            });
            removeEle(city);
            removeEle(district);
            $.each(provinceList[cityItem].cityList, function (i, item) {
                addEle(city, item.name, item.code);
            })
            form.render('select');
        })

        //选定后 将对应的数据读取追加上
        form.on('select(city_code)', function (data) {
            var district = $(data.elem).parents(".layui-form-item").find(".county_code");
            cityText = data.value;
            removeEle(district);
            $.each(provinceList, function (i, item) {
                if (provinceText == item.code) {
                    cityItem = i;
                    return cityItem;
                }
            });
            $.each(provinceList[cityItem].cityList, function (i, item) {
                if (cityText == item.code) {
                    for (var n = 0; n < item.areaList.length; n++) {
                        addEle(district, item.areaList[n]['name'], item.areaList[n]['code']);
                    }
                }
            })
            form.render('select');
        })
    })
</script>